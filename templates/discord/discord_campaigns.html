{% extends "base.html" %}
{% set active_page = 'discord' %}

{% block title %}{{ t("discord") }} - VODUM{% endblock %}
{% block header_title %}{{ t("discord") }}{% endblock %}
{% block header_subtitle %}{{ t("discord_subtitle") }}{% endblock %}

{% block content %}
{% set current_subpage = 'campaigns' %}
{% include "discord/discord_nav.html" %}

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

  <!-- Create campaign -->
  <div class="lg:col-span-1 bg-slate-900 border border-slate-800 rounded-2xl p-4">
    <h2 class="text-sm font-semibold mb-3">{{ t("create_campaign") }}</h2>

    <form method="post" class="space-y-3">
      <div>
        <label class="block mb-1 text-slate-400 text-xs">{{ t("title") }}</label>
        <input type="text" name="title"
               class="w-full bg-slate-950 border border-slate-800 rounded-lg px-3 py-2 text-xs"
               placeholder="{{ t('campaign_title_placeholder') }}">
      </div>

      <div>
        <label class="block mb-1 text-slate-400 text-xs">{{ t("body") }}</label>
        <textarea name="body" rows="6"
                  class="w-full bg-slate-950 border border-slate-800 rounded-lg px-3 py-2 text-xs"
                  placeholder="{{ t('campaign_body_placeholder') }}"></textarea>
      </div>

      <div>
        <label class="block mb-1 text-slate-400 text-xs">{{ t("server_optional") }}</label>
        <select name="server_id"
                class="w-full bg-slate-950 border border-slate-800 rounded-lg px-3 py-2 text-xs">
          <option value="">{{ t("all_servers") }}</option>
          {% for s in servers %}
            <option value="{{ s.id }}">{{ s.name }}</option>
          {% endfor %}
        </select>
      </div>

      <button type="submit"
              class="w-full px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded text-sm">
        {{ t("send") }}
      </button>

      <p class="text-xs text-slate-500">
        {{ t("discord_campaign_note") }}
      </p>
    </form>
  </div>

  <!-- List campaigns -->
  <div class="lg:col-span-2 bg-slate-900 border border-slate-800 rounded-2xl p-4">
    <h2 class="text-sm font-semibold mb-3">{{ t("campaigns") }}</h2>

    <div class="overflow-x-auto">
      <table class="w-full text-xs">
        <thead class="text-slate-400">
          <tr class="border-b border-slate-800">
            <th class="text-left py-2">{{ t("title") }}</th>
            <th class="text-left py-2">{{ t("server") }}</th>
            <th class="text-left py-2">{{ t("status") }}</th>
            <th class="text-left py-2">{{ t("created_at") }}</th>
            <th class="text-right py-2">{{ t("actions") }}</th>
          </tr>
        </thead>
        <tbody>
        {% for c in campaigns %}
          <tr class="border-b border-slate-800">
            <td class="py-2 pr-3 text-slate-200">{{ c.title }}</td>
            <td class="py-2 pr-3 text-slate-300">{{ c.server_name or t("all") }}</td>
            <td class="py-2 pr-3">
              <span class="px-2 py-1 rounded bg-slate-800 text-slate-300">{{ c.status }}</span>
            </td>
            <td class="py-2 pr-3 text-slate-400">{{ c.created_at }}</td>
            <td class="py-2 text-right">
              <form method="post" action="{{ url_for('discord_campaigns_delete') }}">
                <input type="hidden" name="id" value="{{ c.id }}">
                <button class="px-3 py-1.5 rounded bg-rose-700 hover:bg-rose-600 text-white text-xs">
                  {{ t("delete") }}
                </button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="5" class="py-4 text-center text-slate-500">{{ t("no_campaigns") }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
