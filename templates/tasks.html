{% extends "base.html" %}

{% block header_title %}
    {{ t("tasks") }}
{% endblock %}

{% block header_subtitle %}
    {{ t("tasks_desc") }}
{% endblock %}

{% block content %}

<div class="bg-dark-2 p-4 rounded-lg shadow">

    {% if tasks|length >= 1 %}
    <table class="w-full text-left text-sm">
        <thead>
            <tr class="border-b border-slate-800">
                <th class="p-2">ID</th>
                <th class="p-2">{{ t("name") }}</th>
                <th class="p-2">{{ t("description") }}</th>
                <th class="p-2">{{ t("schedule") }}</th>
                <th class="p-2">{{ t("status") }}</th>
                <th class="p-2">{{ t("last_run") }}</th>
                <th class="p-2">{{ t("next_run") }}</th>
                <th class="p-2 text-center">{{ t("actions") }}</th>
            </tr>
        </thead>

        <tbody>
            {% for task in tasks %}
            <tr class="border-b border-slate-800">
                <td class="p-2">{{ task.id }}</td>
                <td class="p-2">{{ task.name }}</td>
                <td class="p-2">
                    {{ t("task." ~ task.name) or task.description }}
                </td>
                <td class="p-2">{{ task.schedule | cron_human }}</td>

                {# ---------- STATUS ---------- #}
                <td class="p-2">
                    {% if not task.enabled %}
                        <span class="px-2 py-1 rounded bg-gray-700 text-gray-300 text-xs">
                            Disabled
                        </span>
                    {% else %}
                        {% if task.status == "running" %}
                            <span class="px-2 py-1 rounded bg-blue-700 text-blue-100 text-xs">
                                Running
                            </span>
                        {% elif task.status == "done" %}
                            <span class="px-2 py-1 rounded bg-green-700 text-green-100 text-xs">
                                Done
                            </span>
                        {% elif task.status == "error" %}
                            <span class="px-2 py-1 rounded bg-red-700 text-red-100 text-xs">
                                Error
                            </span>
                        {% else %}
                            <span class="px-2 py-1 rounded bg-gray-600 text-gray-200 text-xs">
                                Idle
                            </span>
                        {% endif %}
                    {% endif %}
                </td>

                <td class="p-2">{{ task.last_run | tz if task.last_run else "-" }}</td>
                <td class="p-2">{{ task.next_run | tz if task.next_run else "-" }}</td>

                {# ---------- ACTIONS ---------- #}
                <td class="p-2 text-center">
                    {% if not task.enabled %}
                        <button disabled
                                class="px-3 py-1 rounded bg-gray-700 text-gray-400 opacity-50 cursor-not-allowed">
                            {{ t("run_now") }}
                        </button>
                    {% else %}
                        <form action="/tasks/run/{{ task.id }}" method="post">
                            <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-white">
                                {{ t("run_now") }}
                            </button>
                        </form>
                    {% endif %}
                </td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% else %}
        <div class="text-center text-slate-400 p-6">
            {{ t("no_tasks_found") }}
        </div>
    {% endif %}
</div>

{% endblock %}
