<form action="{{ url_for('backup_page') }}" method="post" id="restore-existing-form">
  <input type="hidden" name="action" value="restore">
  <input type="hidden" name="selected_backup" id="selected-backup-input">

  <h2 class="text-sm font-semibold mb-4">
    {{ t("available_backups") }}
  </h2>

  {% if not backups %}
    <p class="text-xs text-slate-500">{{ t("no_backups") }}</p>
  {% else %}
    <div class="overflow-x-auto">
      <table class="w-full text-xs">
        <thead class="bg-slate-950/60 text-slate-400">
          <tr>
            <th class="px-3 py-2 text-left">{{ t("name") }}</th>
            <th class="px-3 py-2 text-left">{{ t("size") }}</th>
            <th class="px-3 py-2 text-left">{{ t("modified_at") }}</th>
            <th class="px-3 py-2 text-center w-24">
              <button
                type="submit"
                id="restore-selected-btn"
                disabled
                class="px-3 py-1 rounded-lg
                       bg-rose-900/40 text-rose-200
                       hover:bg-rose-900/60 text-xs
                       disabled:opacity-40 disabled:cursor-not-allowed">
                {{ t("restore_btn") }}
              </button>
            </th>
          </tr>
        </thead>

        <tbody>
          {% for b in backups %}
          <tr class="border-t border-slate-800">
            <td class="px-3 py-2 font-mono text-[11px]">
              {{ b.name }}
            </td>
            <td class="px-3 py-2 text-slate-300">
              {{ (b.size / 1024)|round(1) }} KB
            </td>
            <td class="px-3 py-2 text-slate-400">
              {{ b.mtime }}
            </td>
            <td class="px-3 py-2 text-center">
              <input type="checkbox" class="backup-check" value="{{ b.name }}">
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
</form>

<script>
  const confirmRestoreText = "{{ t('confirm_restore') }}";

  const checks = document.querySelectorAll('.backup-check');
  const restoreBtn = document.getElementById('restore-selected-btn');
  const hiddenInput = document.getElementById('selected-backup-input');

  checks.forEach(cb => {
    cb.addEventListener('change', () => {
      checks.forEach(other => {
        if (other !== cb) other.checked = false;
      });

      if (cb.checked) {
        hiddenInput.value = cb.value;
        restoreBtn.disabled = false;
      } else {
        hiddenInput.value = "";
        restoreBtn.disabled = true;
      }
    });
  });

  document
    .getElementById("restore-existing-form")
    .addEventListener("submit", e => {
      if (!hiddenInput.value) {
        e.preventDefault();
        return;
      }

      if (!confirm(confirmRestoreText)) {
        e.preventDefault();
      }
    });
</script>
